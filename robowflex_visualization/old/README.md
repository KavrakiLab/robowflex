# Robowflex Visualization
Visualize motion plans and robots in tandem with `robowflex_library` in [Blender](https://www.blender.org/).

## Requirements
1. Blender must be installed with COLLADA loading support (`*.dae`).
2. `python3-yaml` for loading YAML files.

Optionally, `python3-rospkg` can be installed to support resolving of `package://` URIs.
If not found, this is supported by calling the `rospack` command-line tool.


## Usage

1. Generate the robot geometry and a motion plan you would like to visualize using `robowflex_library`.
Robot geometry can be generated by calling `robowflex::Robot::dumpGeometry()` on a loaded robot.
A path can be generated by calling `robowflex::Robot::dumpPathTransforms()` on a loaded robot with a computed plan.
An example of this can be found in `robowflex_library/scripts/ur5_test.cpp` and `robowflex_library/scripts/fetch_test.cpp`.
Planning scenes can be edited manually by writing the YAML file (an example is in `robowflex_library/yaml/test.yml`), or by calling `robowflex::Scene::toYAMLFile()` on a loaded planning scene.

2. Edit the provided file, `scripts/blender.py` to use your desired files.
```py
# blender.py
...

if __name__ == '__main__':
...
    # Load a robot and a path to animate
    blender_robot.animate_robot(
        'my_geometry.yml',      # Robot geometry
        ['my_path.yml']         # Robot paths
    )
    
    # Load a planning scene
    blender_scene.add_planning_scene('my_scene.yml')
    
    # Optionally, configure camera, lighting, and other parameters through a YAML file.
    blender_render.add_blender_scene('my_settings.yml')
```

3. Open blender from the current terminal (`blender`).
   It's best to run blender from the same directory where you have the `blender.py` script.
4. Open the [python console](https://docs.blender.org/manual/en/dev/editors/python_console.html) from the blender window.
5. In the python console, type the following:
 ```py
 filename = 'blender.py'
 exec(compile(open(filename).read(), filename, 'exec'))
 ```
 
6. Repeat while you develop the script outside of blender
(Blender's python editing isn't really worth it.)

## Examples

### `robowflex_library/scripts/fetch_test.cpp`
You can render still images of robots.
<img style="width:100%;max-width:720px;" src="https://s3.amazonaws.com/zk-bucket/robowflex/fetch.png" />

### `robowflex_library/scripts/ur5_test.cpp`
As well as full animations of motion plans.
<img style="width:100%;max-width:720px;" src="https://s3.amazonaws.com/zk-bucket/robowflex/ur5.gif" />
