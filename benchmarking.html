<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Robowflex: Benchmarking Planners in Robowflex</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto&family=Roboto+Mono&display=swap" rel="stylesheet">
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Robowflex
   &#160;<span id="projectnumber">v0.1</span>
   </div>
   <div id="projectbrief">Making MoveIt Easy</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('benchmarking.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Benchmarking Planners in Robowflex </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__home_runner_work_robowflex_robowflex__docs_markdown_benchmarking"></a> Robowflex makes it easy to profile and benchmark motion planners. The primary tool used is <code><a class="el" href="classrobowflex_1_1Profiler.html">robowflex::Profiler</a></code>, which profiles and collects metric data on a motion planning run, producing <code><a class="el" href="classrobowflex_1_1PlanData.html" title="Detailed statistics and metrics computed from profiling a planner&#39;s motion planning.">robowflex::PlanData</a></code>. <code><a class="el" href="classrobowflex_1_1Experiment.html" title="A helper class for benchmarking that controls running multiple queries.">robowflex::Experiment</a></code> uses <code><a class="el" href="classrobowflex_1_1Profiler.html">robowflex::Profiler</a></code> on a collection of motion planning queries (<code><a class="el" href="structrobowflex_1_1PlanningQuery.html" title="A container structure for all elements needed in a planning query, plus an identifying name.">robowflex::PlanningQuery</a></code>) to generate a <code><a class="el" href="classrobowflex_1_1PlanDataSet.html" title="Detailed statistics about a benchmark of multiple queries.">robowflex::PlanDataSet</a></code>. All relevant classes are found in <code><a class="el" href="benchmarking_8h.html">benchmarking.h</a></code>.</p>
<p>For the following documentation, assume we have loaded a Fetch robot and a basic scene and planner, such as this: </p><div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="benchmarking_8h.html">robowflex_library/benchmarking.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ompl__interface_8h.html">robowflex_ompl/ompl_interface.h</a>&gt;</span></div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> <a class="code" href="namespacerobowflex.html#a7fada167b1f9460e9e8e846ac42d77b8">fetch</a> = std::make_shared&lt;FetchRobot&gt;();</div>
<div class="line"><a class="code" href="namespacerobowflex.html#a7fada167b1f9460e9e8e846ac42d77b8">fetch</a>-&gt;initialize();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> <a class="code" href="namespacescene.html">scene</a> = std::make_shared&lt;Scene&gt;(<a class="code" href="namespacerobowflex.html#a7fada167b1f9460e9e8e846ac42d77b8">fetch</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create the OMPL interface planner (from robowflex_ompl), as it has access to planner progress properties</span></div>
<div class="line"><span class="keyword">auto</span> planner = std::make_shared&lt;OMPL::OMPLInterfacePlanner&gt;(<a class="code" href="namespacerobowflex.html#a7fada167b1f9460e9e8e846ac42d77b8">fetch</a>);</div>
<div class="line">planner-&gt;initialize(<span class="stringliteral">&quot;package://robowflex_resources/fetch/config/ompl_planning.yaml&quot;</span>);</div>
<div class="ttc" id="abenchmarking_8h_html"><div class="ttname"><a href="benchmarking_8h.html">benchmarking.h</a></div></div>
<div class="ttc" id="anamespacerobowflex_html_a7fada167b1f9460e9e8e846ac42d77b8"><div class="ttname"><a href="namespacerobowflex.html#a7fada167b1f9460e9e8e846ac42d77b8">robowflex.fetch</a></div><div class="ttdeci">fetch</div><div class="ttdef"><b>Definition:</b> <a href="robowflex_8py_source.html#l00013">robowflex.py:13</a></div></div>
<div class="ttc" id="anamespacescene_html"><div class="ttname"><a href="namespacescene.html">scene</a></div><div class="ttdoc">Functions for loading and animating scenes in Blender.</div></div>
<div class="ttc" id="aompl__interface_8h_html"><div class="ttname"><a href="ompl__interface_8h.html">ompl_interface.h</a></div></div>
</div><!-- fragment --><h1>Profiler</h1>
<p><code><a class="el" href="classrobowflex_1_1Profiler.html">robowflex::Profiler</a></code> is used with <code><a class="el" href="classrobowflex_1_1Experiment.html" title="A helper class for benchmarking that controls running multiple queries.">robowflex::Experiment</a></code>, but can be used standalone to manually profile a single run. Here is a high-level example of creating a profiler and then profiling a plan: </p><div class="fragment"><div class="line"><span class="comment">// Create the profiler</span></div>
<div class="line">Profiler profiler;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ... customize profiler here ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Setup options for profiling run, look at documentation for full list</span></div>
<div class="line">Profiler::Options options;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// What built-in metrics to compute at the end of the run</span></div>
<div class="line">options.metrics = Profiler::WAYPOINTS | Profiler::CORRECT | Profiler::LENGTH | Profiler::SMOOTHNESS;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Profiler results are stored in this PlanData.</span></div>
<div class="line">PlanData result;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Run and profile the plan.</span></div>
<div class="line"><span class="keywordflow">if</span> (profiler.profilePlan(planner, <a class="code" href="namespacescene.html">scene</a>, request-&gt;getRequest(), options, result))</div>
<div class="line">    <a class="code" href="log_8h.html#a2eca843b87983ff89ed09734e5e97a26">RBX_INFO</a>(<span class="stringliteral">&quot;Planning success!&quot;</span>);</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">    <a class="code" href="log_8h.html#a2c44743d46f951f291d07023cfbb62c1">RBX_ERROR</a>(<span class="stringliteral">&quot;Planning failure!&quot;</span>);</div>
<div class="line">    </div>
<div class="line"><span class="comment">// ... look at results here ...</span></div>
<div class="ttc" id="alog_8h_html_a2c44743d46f951f291d07023cfbb62c1"><div class="ttname"><a href="log_8h.html#a2c44743d46f951f291d07023cfbb62c1">RBX_ERROR</a></div><div class="ttdeci">#define RBX_ERROR(fmt,...)</div><div class="ttdoc">Output a error logging message.</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00102">log.h:102</a></div></div>
<div class="ttc" id="alog_8h_html_a2eca843b87983ff89ed09734e5e97a26"><div class="ttname"><a href="log_8h.html#a2eca843b87983ff89ed09734e5e97a26">RBX_INFO</a></div><div class="ttdeci">#define RBX_INFO(fmt,...)</div><div class="ttdoc">Output a info logging message.</div><div class="ttdef"><b>Definition:</b> <a href="log_8h_source.html#l00118">log.h:118</a></div></div>
</div><!-- fragment --><p> Take a look at the documentation for <code><a class="el" href="classrobowflex_1_1Profiler.html">robowflex::Profiler</a></code> for further options. Additionally, look at <code><a class="el" href="classrobowflex_1_1PlanData.html" title="Detailed statistics and metrics computed from profiling a planner&#39;s motion planning.">robowflex::PlanData</a></code> for what information is computed by default by the profiler, such as planning time. For an in-depth example of how to use <code><a class="el" href="classrobowflex_1_1Profiler.html">robowflex::Profiler</a></code>, look at <code><a class="el" href="fetch__profile_8cpp.html">robowflex_ompl/scripts/fetch_profile.cpp</a></code>.</p>
<h2>Planning Metrics</h2>
<p>An important feature of the profiler is that you can add custom metrics to compute at the end of a run. After adding a custom metric, these are automatically computed and added to the <code><a class="el" href="classrobowflex_1_1PlanData.html" title="Detailed statistics and metrics computed from profiling a planner&#39;s motion planning.">robowflex::PlanData</a></code>. These metrics can also be added to the profiler used inside of a <code><a class="el" href="classrobowflex_1_1Experiment.html" title="A helper class for benchmarking that controls running multiple queries.">robowflex::Experiment</a></code> (using <code><a class="el" href="classrobowflex_1_1Experiment.html#ae1942c1b23882d49df1b34892ffdd6c2" title="Get a reference to the profiler used by the experiment. Add callback functions to this profiler for c...">robowflex::Experiment::getProfiler()</a></code>), to add metrics in a benchmark.</p>
<p>Here is an example of a metric that returns distance-to-go to the goal (using <code><a class="el" href="classrobowflex_1_1OMPL_1_1OMPLInterfacePlanner.html" title="A planner that directly uses MoveIt!&#39;s OMPL planning interface.">robowflex::OMPL::OMPLInterfacePlanner</a></code>, as above). The resulting metric will be stored in <code><a class="el" href="classrobowflex_1_1PlanData.html#aa8b25765392030bf2cf8712eac14c8d3" title="Map of metric name to value.">robowflex::PlanData::metrics</a></code> under the name "goal_distance".</p>
<div class="fragment"><div class="line"><span class="comment">// ... create profiler ...</span></div>
<div class="line"> </div>
<div class="line">profiler.addMetricCallback(<span class="stringliteral">&quot;goal_distance&quot;</span>,                          <span class="comment">//</span></div>
<div class="line">    [](<span class="keyword">const</span> <a class="code" href="classrobowflex_1_1PlannerPtr.html">PlannerPtr</a> &amp;planner,                                    <span class="comment">//</span></div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classrobowflex_1_1SceneConstPtr.html">SceneConstPtr</a> &amp;<a class="code" href="namespacescene.html">scene</a>,                            <span class="comment">//</span></div>
<div class="line">              <span class="keyword">const</span> <a class="codeRef" target="_blank" href="http://docs.ros.org/melodic/api/moveit_core/html/namespaceplanning__interface.html#a66b7da9ae05ece3dbde7605d89208ae8">planning_interface::MotionPlanRequest</a> &amp;request,  <span class="comment">//</span></div>
<div class="line">              <span class="keyword">const</span> PlanData &amp;run) -&gt; <a class="code" href="namespacerobowflex.html#af95cfc04fe2f34f307819d42a0760550">PlannerMetric</a> {</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;ompl_planner = std::dynamic_pointer_cast&lt;const OMPL::OMPLInterfacePlanner&gt;(planner);</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;pdef = ompl_planner-&gt;getLastSimpleSetup()-&gt;getProblemDefinition();</div>
<div class="line">        <span class="keywordflow">return</span> pdef-&gt;getSolutionDifference();</div>
<div class="line">    };</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ... profile plan ....</span></div>
<div class="ttc" id="aclassrobowflex_1_1PlannerPtr_html"><div class="ttname"><a href="classrobowflex_1_1PlannerPtr.html">PlannerPtr</a></div><div class="ttdoc">A shared pointer wrapper for robowflex::Planner.</div></div>
<div class="ttc" id="aclassrobowflex_1_1SceneConstPtr_html"><div class="ttname"><a href="classrobowflex_1_1SceneConstPtr.html">SceneConstPtr</a></div><div class="ttdoc">A const shared pointer wrapper for robowflex::Scene.</div></div>
<div class="ttc" id="anamespaceplanning__interface_html_a66b7da9ae05ece3dbde7605d89208ae8"><div class="ttname"><a href="http://docs.ros.org/melodic/api/moveit_core/html/namespaceplanning__interface.html#a66b7da9ae05ece3dbde7605d89208ae8">planning_interface::MotionPlanRequest</a></div><div class="ttdeci">moveit_msgs::MotionPlanRequest MotionPlanRequest</div></div>
<div class="ttc" id="anamespacerobowflex_html_af95cfc04fe2f34f307819d42a0760550"><div class="ttname"><a href="namespacerobowflex.html#af95cfc04fe2f34f307819d42a0760550">robowflex::PlannerMetric</a></div><div class="ttdeci">boost::variant&lt; bool, double, int, std::size_t, std::string &gt; PlannerMetric</div><div class="ttdoc">Variant type of possible values a run metric could be.</div><div class="ttdef"><b>Definition:</b> <a href="benchmarking_8h_source.html#l00033">benchmarking.h:33</a></div></div>
</div><!-- fragment --><p>Note that planning metrics are stored as a boost variant type. In order to extract the underlying data, you will have to do something like the following: </p><div class="fragment"><div class="line">PlanData result;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ... profile goes here ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> goal_distance = boost::get&lt;double&gt;(result.metrics[<span class="stringliteral">&quot;goal_distance&quot;</span>]);</div>
</div><!-- fragment --><h2>Planner Progress Properties</h2>
<p>Some planners also expose <em>progress properties</em>, which are planner metrics that change over the course of a planning run. A common use-case for these properties is to profile asymptotically optimal planners (such as RRT*) with properties such as the best path cost so far or number of iterations. The profiler automatically includes whatever progress properties are exposed through the planner itself, that is, through the <code><a class="el" href="classrobowflex_1_1Planner.html#aa92ec03150c324a4e136318ebddbae51" title="Retrieve the planner progress property map for this planner given a specific request.">robowflex::Planner::getProgressProperties()</a></code> function. If you are using <code>robowflex_ompl</code> <code><a class="el" href="classrobowflex_1_1OMPL_1_1OMPLInterfacePlanner.html" title="A planner that directly uses MoveIt!&#39;s OMPL planning interface.">robowflex::OMPL::OMPLInterfacePlanner</a></code>, this will return the underlying OMPL planner's progress properties. The profiler captures progress properties by spinning up a separate thread that queries the planner for each property at a specified update rate.</p>
<p>There are a number of options associated with the progress properties, look at the documentation for more information: </p><div class="fragment"><div class="line">Profiler::Options options;</div>
<div class="line">options.progress = <span class="keyword">true</span>;</div>
<div class="line">options.progress_at_least_once = <span class="keyword">true</span>;</div>
<div class="line">options.progress_update_rate = 0.1;</div>
</div><!-- fragment --><p>You can also specify custom progress properties for the profiler to use. Progress properties are specified through progress property allocator functions, which generate the query at the start of the profiling run, so that the function can be customized to the specifics of the query. Here is an example of a progress property that counts the number of vertices in the OMPL planning graph: </p><div class="fragment"><div class="line"><span class="comment">// ... create profiler ...</span></div>
<div class="line"> </div>
<div class="line">profiler.addProgressAllocator(<span class="stringliteral">&quot;num vertices INTEGER&quot;</span>,  <span class="comment">//</span></div>
<div class="line">    [](<span class="keyword">const</span> <a class="code" href="classrobowflex_1_1PlannerPtr.html">PlannerPtr</a> &amp;planner,                      <span class="comment">//</span></div>
<div class="line">              <span class="keyword">const</span> <a class="code" href="classrobowflex_1_1SceneConstPtr.html">SceneConstPtr</a> &amp;<a class="code" href="namespacescene.html">scene</a>,              <span class="comment">//</span></div>
<div class="line">              <span class="keyword">const</span> <a class="codeRef" target="_blank" href="http://docs.ros.org/melodic/api/moveit_core/html/namespaceplanning__interface.html#a66b7da9ae05ece3dbde7605d89208ae8">planning_interface::MotionPlanRequest</a> &amp;request) -&gt; Planner::ProgressProperty {</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;ompl_planner = std::dynamic_pointer_cast&lt;const OMPL::OMPLInterfacePlanner&gt;(planner);</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;ss = ompl_planner-&gt;getLastSimpleSetup();</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;op = ss-&gt;getPlanner();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> [op] {</div>
<div class="line">            ompl::base::PlannerData pd(op-&gt;getSpaceInformation());</div>
<div class="line">            op-&gt;getPlannerData(pd);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> <a class="codeRef" target="_blank" href="http://en.cppreference.com/w/cpp/string/basic_string/to_string.html">std::to_string</a>(pd.numVertices());</div>
<div class="line">        };</div>
<div class="line">    });</div>
<div class="line">    </div>
<div class="line"><span class="comment">// ... profile plan ....</span></div>
<div class="ttc" id="ato_string_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/string/basic_string/to_string.html">std::to_string</a></div><div class="ttdeci">T to_string(T... args)</div></div>
</div><!-- fragment --><p>There are a few things to note. First, if there are any progress properties captured, there is also a progress property called "time REAL" that is captured in tandem, which is the time that the progress property was captured in seconds since planning started. Second, all progress properties are strings. Third, all progress property names must include their datatype at the end of their name. These are datatypes supported by SQL, e.g., "INTEGER", "VARCHAR(128)", etc. This is to tell the benchmark experiment output functions how to encode the data.</p>
<p>Say you wanted to extract the "num vertices INTEGER" in a usable format, such as a time series. You could do something like the following: </p><div class="fragment"><div class="line">PlanData result;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ... profile goes here ...</span></div>
<div class="line"> </div>
<div class="line"><a class="codeRef" target="_blank" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;double&gt;</a> times;</div>
<div class="line"><a class="codeRef" target="_blank" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int&gt;</a> verts;</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;sample : result.progress)</div>
<div class="line">{</div>
<div class="line">    times.<a class="codeRef" target="_blank" href="http://en.cppreference.com/w/cpp/container/vector/emplace_back.html">emplace_back</a>(boost::lexical_cast&lt;double&gt;(sample[<span class="stringliteral">&quot;time REAL&quot;</span>]));</div>
<div class="line">    verts.<a class="codeRef" target="_blank" href="http://en.cppreference.com/w/cpp/container/vector/emplace_back.html">emplace_back</a>(boost::lexical_cast&lt;int&gt;(sample[<span class="stringliteral">&quot;num vertices INTEGER&quot;</span>]));</div>
<div class="line">}</div>
<div class="ttc" id="aemplace_back_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/container/vector/emplace_back.html">std::vector::emplace_back</a></div><div class="ttdeci">T emplace_back(T... args)</div></div>
<div class="ttc" id="avector_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt; double &gt;</a></div></div>
</div><!-- fragment --><p>You can also add simple callback functions to the profiler that are called at the same rate as the progress properties, e.g., </p><div class="fragment"><div class="line">profiler.addProgressCallback([](<span class="keyword">const</span> <a class="code" href="classrobowflex_1_1PlannerPtr.html">PlannerPtr</a> &amp;planner,                             <span class="comment">//</span></div>
<div class="line">                                <span class="keyword">const</span> <a class="code" href="classrobowflex_1_1SceneConstPtr.html">SceneConstPtr</a> &amp;<a class="code" href="namespacescene.html">scene</a>,                            <span class="comment">//</span></div>
<div class="line">                                <span class="keyword">const</span> <a class="codeRef" target="_blank" href="http://docs.ros.org/melodic/api/moveit_core/html/namespaceplanning__interface.html#a66b7da9ae05ece3dbde7605d89208ae8">planning_interface::MotionPlanRequest</a> &amp;request,  <span class="comment">//</span></div>
<div class="line">                                <span class="keyword">const</span> PlanData &amp;result) {</div>
<div class="line">        <a class="codeRef" target="_blank" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Wow! A callback!&quot;</span> &lt;&lt; <a class="codeRef" target="_blank" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line">    });</div>
<div class="ttc" id="abasic_ostream_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a></div></div>
<div class="ttc" id="aendl_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a></div><div class="ttdeci">T endl(T... args)</div></div>
</div><!-- fragment --><h1>Experiment</h1>
<p><code><a class="el" href="classrobowflex_1_1Experiment.html" title="A helper class for benchmarking that controls running multiple queries.">robowflex::Experiment</a></code> is a wrapper that profiles a number of motion planning queries and collects all data into a <code><a class="el" href="classrobowflex_1_1PlanDataSet.html" title="Detailed statistics about a benchmark of multiple queries.">robowflex::PlanDataSet</a></code>. It is simple to setup and run an experiment: </p><div class="fragment"><div class="line">Profiler::Options options;</div>
<div class="line"><span class="comment">// ... setup options ...</span></div>
<div class="line"> </div>
<div class="line">Experiment experiment( <span class="comment">//</span></div>
<div class="line">  <span class="stringliteral">&quot;demo&quot;</span>,  <span class="comment">// Name of the experiment. This is encoded in output files so experiments can be told apart.</span></div>
<div class="line">  options, <span class="comment">// Options used by the underlying profiler. Can be modifed later by using Experiment::getOptions().</span></div>
<div class="line">  60.0,    <span class="comment">// Total time allotted to each query. This overrides whatever is in the request, unless you call</span></div>
<div class="line">           <span class="comment">//   Experiment::overridePlanningTime().</span></div>
<div class="line">  100,     <span class="comment">// Total number of trials that each query should be profiled for.</span></div>
<div class="line">  <span class="keyword">false</span>    <span class="comment">// (Optional, defaults to false) If true, the benchmarker will re-run each query until the *total* </span></div>
<div class="line">           <span class="comment">//   time has exceeded the allotted time. That is, say 5 seconds are allotted to a query. The </span></div>
<div class="line">           <span class="comment">//   planner solves the problem in 3 seconds. The benchmarker will then re-run the same query but </span></div>
<div class="line">           <span class="comment">//   only with a time budget of 2 seconds.</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add a named query to the experiment.</span></div>
<div class="line"><span class="comment">// These consist of the planning scene, the motion planner, and the request.</span></div>
<div class="line"><span class="comment">// Note that you can add *multiple* queries under the same name - the experiment will collect the data under</span></div>
<div class="line"><span class="comment">// the same name if this is the case.</span></div>
<div class="line"><span class="comment">// This is useful if you have variations on a planning scene.</span></div>
<div class="line">experiment.addQuery(<span class="stringliteral">&quot;basic&quot;</span>, <a class="code" href="namespacescene.html">scene</a>, planner, request);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ... add pre &amp; post run callbacks to experiment ...</span></div>
<div class="line">experiment.setPreRunCallback([&amp;](<span class="keyword">const</span> PlannerQuery &amp;query) {</div>
<div class="line">    <a class="codeRef" target="_blank" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::cout</a> &lt;&lt; <span class="stringliteral">&quot;Running query &quot;</span> &lt;&lt; query.name &lt;&lt; <a class="codeRef" target="_blank" href="http://en.cppreference.com/w/cpp/io/manip/endl.html">std::endl</a>;</div>
<div class="line"> });</div>
<div class="line"> </div>
<div class="line">Profiler &amp;profiler = experiment.getProfiler();</div>
<div class="line"><span class="comment">// ... modify profiler, e.g., add custom metrics ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Run Benchmark!</span></div>
<div class="line"><a class="code" href="classrobowflex_1_1PlanDataSetPtr.html">PlanDataSetPtr</a> dataset = experiment.benchmark(1);</div>
<div class="ttc" id="aclassrobowflex_1_1PlanDataSetPtr_html"><div class="ttname"><a href="classrobowflex_1_1PlanDataSetPtr.html">PlanDataSetPtr</a></div><div class="ttdoc">A shared pointer wrapper for robowflex::PlanDataSet.</div></div>
</div><!-- fragment --><p>Note that you can add pre- and post-run callbacks to the experiment that run for every trial. There is also post-query callback that is called after a run's data has been entered into the dataset.</p>
<p>Finally, you can output <code><a class="el" href="classrobowflex_1_1PlanDataSet.html" title="Detailed statistics about a benchmark of multiple queries.">robowflex::PlanDataSet</a></code> to a number of output file types, all of which inherit from <code><a class="el" href="classrobowflex_1_1PlanDataSetOutputter.html" title="An abstract class for outputting benchmark results.">robowflex::PlanDataSetOutputter</a></code>, e.g., </p><div class="fragment"><div class="line">OMPLPlanDataSetOutputter output(<span class="stringliteral">&quot;results&quot;</span>);</div>
<div class="line">output.dump(*dataset);</div>
</div><!-- fragment --><p> The resulting log files from <code><a class="el" href="classrobowflex_1_1OMPLPlanDataSetOutputter.html" title="Benchmark outputter that saves results into OMPL benchmarking log files. If ompl_benchmark_statistics...">robowflex::OMPLPlanDataSetOutputter</a></code> can be used with OMPL's <code>ompl_benchmark_statistics.py</code> script to generate benchmarking databases. See <a href="http://ompl.kavrakilab.org/benchmark.html">the OMPL documentation for benchmarking</a> for more information. The resulting database can be viewed online at <a href="http://plannerarena.org/">plannerarena.org</a>.</p>
<p>For an in-depth example of how to use <code><a class="el" href="classrobowflex_1_1Experiment.html" title="A helper class for benchmarking that controls running multiple queries.">robowflex::Experiment</a></code>, look at:</p><ul>
<li><code><a class="el" href="fetch__benchmark_8cpp.html">robowflex_library/scripts/fetch_benchmark.cpp</a></code>.</li>
<li><code><a class="el" href="fetch__scenes__benchmark_8cpp.html">robowflex_library/scripts/fetch_scenes_benchmark.cpp</a></code>.</li>
<li><code><a class="el" href="fetch__ompl__benchmark_8cpp.html">robowflex_ompl/scripts/fetch_ompl_benchmark.cpp</a></code>.</li>
<li><code><a class="el" href="fetch__ompl__scenes__benchmark_8cpp.html">robowflex_ompl/scripts/fetch_ompl_scenes_benchmark.cpp</a></code>.</li>
</ul>
<p><b>IMPORTANT</b> If you are using the <code>robowflex_ompl</code> <code><a class="el" href="classrobowflex_1_1OMPL_1_1OMPLInterfacePlanner.html" title="A planner that directly uses MoveIt!&#39;s OMPL planning interface.">robowflex::OMPL::OMPLInterfacePlanner</a></code> you cannot benchmark with multiple threads, as the underlying planner is context sensitive. Use only one thread if profiling queries that contain this planner. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
            <a href="http://www.kavrakilab.org">Kavraki Lab</a>  &bull;
            <a href="https://www.cs.rice.edu">Department of Computer Science</a> &bull;
            <a href="https://www.rice.edu">Rice University</a> &bull;
            Funded in part by the <a href="https://www.nsf.gov">National Science Foundation</a> &bull;
            Documentation generated by <a href="http://www.doxygen.org/index.html">doxygen</a> 1.9.1
    </li>
  </ul>
</div>
</body>
</html>
